<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<title>메인화면</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
	crossorigin="anonymous">
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
	crossorigin="anonymous"></script>
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<style type="text/css">
input {
	border: none;
}

.content {
	max-height: 0;
	overflow: hidden;
	transition: max-height 0.3s ease-out;
} /* 부드러운 전환 효과 */
</style>
<script>
	$(document).ready(
			function() {
				const pid = $('#pid').val(); // 현재 사용자 ID

				function updateScrapButtons() {
					$('.scrap-button').each(
							function() {
								const button = $(this);
								const post_idx = button.data('post-idx');

								// 스크랩 상태 확인 요청
								$.ajax({
									url : `/Person/CheckScrap?post_idx=`
											+ post_idx + '&pid=${pid}',
									type : 'GET',
									dataType : 'json',
									success : function(isScraped) {
										button.data('scraped', isScraped);
										button.toggleClass('btn-primary',
												isScraped).toggleClass(
												'btn-outline-secondary',
												!isScraped).val(
												isScraped ? '스크랩 해제' : '스크랩');
									},
									error : function(error) {
										console.error('Error:', error);
									}
								});
							});
				}

				updateScrapButtons(); // 페이지 로드 시 스크랩 버튼 상태 갱신

				$('.scrap-button').click(
						function() {
							const button = $(this);
							const post_idx = button.data('post-idx');
							const isScraped = button.data('scraped');

							if (isScraped) {
								// 스크랩 삭제 요청
								$.ajax({
									url : `/Person/ScrapDelete?post_idx=`
											+ post_idx + '&pid=${pid}',
									type : 'POST',
									success : function(response) {
										alert('스크랩이 해제되었습니다.');
										updateScrapButtons(); // 모든 스크랩 버튼 상태 갱신
									},
									error : function(error) {
										console.error('Error:', error);
										alert('오류가 발생했습니다. 다시 시도해주세요.');
									}
								});
							} else {
								// 스크랩 추가 요청
								$.ajax({
									url : '/Person/ScrapAdd',
									type : 'POST',
									contentType : 'application/json',
									data : JSON.stringify({
										post_idx : post_idx,
										pid : pid
									}),
									success : function(response) {
										alert('스크랩되었습니다.');
										updateScrapButtons(); // 모든 스크랩 버튼 상태 갱신
									},
									error : function(error) {
										console.error('Error:', error);
										alert('오류가 발생했습니다. 다시 시도해주세요.');
									}
								});
							}
						});
			});
</script>
</head>

<body>
	<main class="container-fluid">
		<div class="row">
			<nav class="col-2 bg-white sticky-top vh-100">
				<div th:insert="layout/nav.html :: nav"></div>
			</nav>
			<div class="justify-content-center col-9 container">

				<div class="border mt-5" th:each="item, iterStat : ${posts}">
					<div class="d-flex flex-column my-4 px-4">
						<!-- First content block -->
						<div class="d-flex justify-content-between mb-3">
							<input type="text" th:value="${item.post_id}" disabled> <input
								class="text-end" type="text"
								th:value="${item.post_updated_date}" readonly="readonly"
								disabled>
						</div>
						<div>
							<div th:each="file : ${item.fileList}">
								<img th:src="${file.file_Path}" alt="게시글 이미지"
									style="width: auto; max-height: 300px;">
							</div>

							<div class="mt-3 content px-3"
								th:id="'content' + ${iterStat.index}" style="max-height: 100px;"
								th:text="${item.post_contents}"></div>
						</div>
						<button class="toggleButton btn btn-primary"
							th:data-target="'content' + ${iterStat.index}"
							aria-controls="content1" aria-expanded="false">더보기</button>

						<div class="ms-3 my-1">
							<span class="fw-bold" th:attr="data-post-idx=${item.post_idx}"><svg
									class="w-6 h-6 text-gray-800 dark:text-white"
									aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
									width="24" height="24" fill="none" viewBox="0 0 24 24">
 								 <path stroke="currentColor" stroke-linecap="round"
										stroke-linejoin="round" stroke-width="2"
										d="M12.01 6.001C6.5 1 1 8 5.782 13.001L12.011 20l6.23-7C23 8 17.5 1 12.01 6.002Z" />
								</svg> </span> <input type="text" class="fw-bold bg-transparent text-muted"
								id="userName" name="userName" readonly disabled
								style="border: none;"></input>
						</div>
						<div class="container-fluid" style="height: 9rem">댓글창</div>
						<div>
							<input class="form-control border-bottom border-top" type="text"
								placeholder="댓글 달기..." style="border: none; height: 3rem">
							<button type="submit"
								class="btn float-end bg-transparent text-primary"
								style="margin-top: -38px; border: none;">게시</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>
	<script src="/js/youtubeLink.js"></script>
	<script src="/js/toggleButton.js"></script>

</body>

</html>