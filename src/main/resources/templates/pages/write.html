<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
	crossorigin="anonymous">
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
	crossorigin="anonymous"></script>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
<script>
$(document).ready(function() {
	
	var tags = [];
	
    // Enter 키 입력 시 태그 추가
$("#tagInput").keypress(function(event) {
    if (event.which === 13) { // Enter key
        event.preventDefault();
        var tagName = $("#tagInput").val().trim();
        if (tagName !== "") {
            // 태그 배열에 추가
            tags.push(tagName);

            var tagButton = $("<input>").attr({
                "type": "button",
                "class": "btn btn-outline-primary btn-sm m-1 mt-3 tag-btn",
                "value": tagName
            });
            $("#tagContainer").append(tagButton);

            // 입력창 초기화
            $("#tagInput").val("");
        }
    }
});
    
$("#postWrite").submit(function() {
    // 태그 배열을 JSON 문자열로 변환하여 숨겨진 input 필드에 설정
    $('<input>').attr({
        type: 'hidden',
        name: 'tags',
        value: JSON.stringify(tags)
    }).appendTo(this);
    
    return true; // 폼 제출 계속 진행
});
    
    // 태그 삭제 버튼 클릭 시 태그 삭제
    $(document).on("click", ".tag-btn", function() {
        $(this).remove();
    });
    
    $('#images').on('change', function() {
        var files = $(this)[0].files;
        var fileNames = [];

        for (var i = 0; i < files.length; i++) {
            fileNames.push(files[i].name);
        }

        var displayText = fileNames.join(', ');
        if (displayText === '') {
            displayText = '선택된 파일 없음';
        }

        $('#file-names').text(displayText);
    });
    const area = $("#post_contents");

    // 입력이 발생할 때마다 localStorage에 내용 저장
    area.on("input", function() {
        console.log(area.val());
    });

    // 페이지를 나갈 때 localStorage에 내용 저장
    $(window).on("beforeunload", function() {
        localStorage.setItem("textArea", area.val());
    });

    // 페이지 로드 시 localStorage에서 내용 불러오기
    if (localStorage.getItem("textArea")) {
        if (confirm("최근 작성한 글을 불러오시겠습니까?")) {
            console.log(localStorage.getItem("textArea"));
            // jQuery의 val() 메서드를 사용하여 값 설정
            area.val(localStorage.getItem("textArea"));
        } else {
            localStorage.removeItem("textArea");
        }
    }
    // "목록" 버튼 클릭 시 이벤트 핸들러
    $('#btn-list').click(function() {
        location.href = '/main'; // 페이지 이동
    });

    // "취소" 버튼 클릭 시 이벤트 핸들러
    $('#btn-cancel').click(function() {
        $('#post_title').val(''); // 글 제목 입력 필드 초기화
        $('#post_contents').val(''); // 내용 입력 필드 초기화
    });
});
</script>
</head>
<body>
	<main class="container mt-5">
		<div class="row">
			<div class="col-sm">
				<form id="postWrite" action="/write" method="post" enctype="multipart/form-data">
					<input type="hidden" name="post_id" th:value="${user.user_id}" />
					<input type="hidden" name="post_name" th:value="${user.user_name}" />
					<div class="form-floating my-3">
						<input type="text" class="form-control" name="post_title"
							id="post_title" /> <label for="post_title">글 제목</label>
					</div>

					<div class="form-floating my-3">
						<textarea rows="20" class=" form-control" id="post_contents"
							name="post_contents" style="height: 250px; width: 100%;"></textarea>
						<label for="post_contents">내용</label>
					</div>
					<div class="form-floating my-3">
						<input type="text" class="form-control" id="tagInput"/> <label for="tagInput">태그</label>
						<div id="tagContainer"></div>
					</div>
					<div class="my-2 d-flex justify-content-between align-items-center">
						<div>
							<button type="button" id="btn-list" class="btn btn-secondary">목록</button>
							<label class="btn" for="images"> <i
								class="bi bi-card-image fs-1"></i></label> <input type="file"
								class="form-control" id="images" name="images" multiple
								style="display: none;"> <span id="file-names"
								class="text-muted">선택된 파일 없음</span>
						</div>
						<div>
							<button type="reset" id="btn-reset" class="btn btn-warning">리셋</button>
							<button type="submit" id="btn-submit"
								class="btn btn-primary me-2">등록</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</main>
</body>
</html>