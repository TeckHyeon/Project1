<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

</head>
<body>
	<div th:fragment="nav"
		class="d-flex flex-column flex-shrink-0 p-3 bg-body-tertiary navbar-fixed-left"
		style="width: 280px;">
		<a href="/main"
			class="d-flex align-items-center mb-5 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
			<svg class="bi pe-none me-2" width="40" height="32">
						<use xlink:href="#bootstrap"></use>
					</svg> <span class="fs-4">Sidebar</span>
		</a>

		<ul class="nav nav-pills flex-column mb-auto">
			<li class="nav-item mt-5"><a href="/"
				class="nav-link link-body-emphasis" aria-current="page">Home </a></li>
			<li><a href="#" class="nav-link link-body-emphasis">검색 </a></li>
			<li><div th:if="${user != null}">
					<div id="notificationArea">
					<div th:replace="layout/notifragment.html :: noti"></div>
					
					</div>
				</div>
				<div th:unless="${user != null}">
					<a class="nav-link link-body-emphasis mx-0" href="/login">알림</a>
				</div></li>

			<li><a href="#" class="nav-link link-body-emphasis">프로필 </a></li>
		</ul>
		<hr>
		<div class="dropdown" th:if="${user != null}">
			<a href="#"
				class="d-flex align-items-center link-body-emphasis text-decoration-none dropdown-toggle"
				data-bs-toggle="dropdown" aria-expanded="false"> <img
				src="https://github.com/mdo.png" alt="" width="32" height="32"
				class="rounded-circle me-2"> <strong
				th:text="${user.user_name}"></strong>
			</a>
			<ul class="dropdown-menu text-small shadow">
				<li><a class="dropdown-item" href="/write/"
					th:attrappend="href=${user.user_id}">글쓰기</a></li>
				<li><a class="dropdown-item" href="/updateform/"
					th:attrappend="href=${user.user_id}">회원정보수정</a></li>
				<li><a class="dropdown-item" href="/profile/"
					th:attrappend="href=${user.user_id}">>프로필</a></li>
				<li>
					<hr class="dropdown-divider">
				</li>
				<li><a class="dropdown-item" href="/logout">로그아웃</a></li>
			</ul>
		</div>
		<a class="btn btn-primary" href="/login" th:unless="${user != null}">로그인</a>
		
<script>
	$(document).ready(function() {
		function fetchNotifications() {
			$.ajax({
				url : '/notiRefresh',
				success : function(data) {

					$('#notificationArea').html(data);
				}
			});
		}
		setInterval(fetchNotifications, 10000);
		
		 $(document).on('hidden.bs.modal', '.modal', function(e) {
			var notiIdx = $(this).attr('id').replace('postDetail', '');
			console.log(notiIdx);
				$.ajax({
					url : '/CheckNoti',
					type: 'POST',
					data: {notification_idx: notiIdx},
					success : function(response) {
						fetchNotifications();
					}
				});
		});
	});
</script>

	</div>
</body>
</html>